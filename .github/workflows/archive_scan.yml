name: Archive Scan Results

on:
  workflow_run:
    workflows: ["Trust Scan Bot"]
    types:
      - completed

jobs:
  archive-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Timestamp scan_results.json
        run: |
          ts=$(date +%Y%m%d_%H%M%S)
          mkdir -p archive
          cp output/scan_results.json archive/scan_results_$ts.json

      - name: Configure Git
        run: |
          git config user.name "TrustBot"
          git config user.email "trustbot@local"

      - name: Commit archive file
        run: |
          git add archive/
          git commit -m "Archive scan results at $(date -u +'%Y-%m-%d %H:%M:%S UTC')" || echo "No changes to commit"
          git push
